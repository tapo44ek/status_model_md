# Модуль базы данных
1. [Примеры запросов для добавления данных с бэкэнда](/Database/backend_operations.md)
2. [SQL запросов на создание таблиц](/Database/sql/create_tables.sql)
3. [SQL запросов на создание представлений](/Database/sql/create_views.sql)

# ER-схема базы данных
![er-chart](/Database/db_diagram.png)

# Новая статусная модель
## Этапы работы и ожидаемые сроки из завершения
| ID  | Группа           | Статус                                | Требуемые действия                                     | Срок | Индикатор даты (snake case)            |
| --- | ---------------- | ------------------------------------- | ------------------------------------------------------ | ---- | -------------------------------------- |
| 1   | Не требуется     | Свободно                              | Не требуется отселения                                 | null | order_date                             |
| 2   | Проблемные       | Не закреплено                         | Требуется оформить проблемную площадь                  | 7    | problem_date                           |
| 3   | Первичная работа | Не предлагалось                       | Требуется направить смотровой                          | 7    | free_date                              |
| 4   | Первичная работа | На осмотре                            | Требуется получить ответ по смотровому                 | 19   | inspection_date                        |
| 5   | Отказ            | Отказ                                 | Требуется переподбор                                   | 19   | reject_date                            |
| 6   | Отказ            | Переподбор                            | Требуется получить ответ по переподбору                | 19   | reinspection_date                      |
| 7   | Распоряжение     | Согласие                              | Требуется издать РД по согласию                        | 30   | accept_date                            |
| 8   | Распоряжение     | РД                                    | Требуется подготовить проект договора                  | 37   | rd_date                                |
| 9   | Договор          | Проект договора                       | Требуется уведомить о готовности договора              | 45   | contract_project_date                  |
| 10  | Договор          | Уведомление                           | Требуется подписать договор                            | 60   | contract_notification_date             |
| 11  | Договор          | Назначено подписание                  | Требуется подписать договор                            | 60   | contract_prelimenary_signing_date      |
| 12  | МФР              | В работе МФР                          | Требуется завершить работу МФР                         | 120  | mfr_date                               |
| 13  | Суд              | Готовится иск                         | Требуется подать иск                                   | 150  | claim_start_date                       |
| 14  | Суд              | Судебные разбирательства              | Требуется добиться решения суда                        | 210  | claim_submit_date                      |
| 15  | Суд              | Решение суда                          | Требуется запросить исполнительный лист                | 210  | claim_won_date                         |
| 16  | Проигранный суд  | Не предлагалось (проигранный суд)     | Требуется направить смотровой (после суда)             | 217  | claim_lost_date                        |
| 17  | Проигранный суд  | На осмотре (проиграный суд)           | Требуется получить ответ по смотровому (после суда)    | 229  | lost_inspection_date                   |
| 18  | Проигранный суд  | Согласие (проиграный суд)             | Требуется издать РД по согласию (после суда)           | 240  | lost_accept_date                       |
| 19  | Проигранный суд  | РД (проиграный суд)                   | Требуется подготовить проект договора (после суда)     | 247  | lost_rd_date                           |
| 20  | Проигранный суд  | Проект договора (проиграный суд)      | Требуется уведомить о готовности договора (после суда) | 255  | lost_contract_project_date             |
| 21  | Проигранный суд  | Назначено подписание (проиграный суд) | Требуется подписать договор (после суда)               | 270  | lost_contract_prelimenary_signing_date |
| 22  | ФССП             | Запрошен ИЛ                           | Требуется возбудить ИП                                 | 220  | fssp_list_date                         |
| 23  | ФССП             | Возбуждено ИП                         | Требуется добиться исполнения решения                  | 230  | fssp_institute_date                    |
| 24  | ФССП             | РД (выигранный суд)                   | Требуется подготовить проект договора по суду          | 240  | won_rd_date                            |
| 25  | ФССП             | Проект договора (выигранный суд)      | Требуется заключить договор по суду                    | 245  | won_contract_project_date              |
| 26  | Завершено        | Договор подписан                      | Работа завершена                                       | null | contract_date                          |
| 27  | Завершено        | Переселён без договора                | Работа завершена                                       | null | -                                      |


# Старая статусная модель 
## Этапы и ожидаемые сроки их завершения в зависимости от проблемности (р.д.)
| Статус                               |  Обычное  |  Проблемный  |  Переподбор  |  Суд  |  МФР  |
|--------------------------------------|-----------|--------------|--------------|-------|-------|
|  Не требуется - свободно             |  -        |  -           |  -           |  -    |  -    |
|  МФР - в работе                      |  -        |  -           |  -           |  -    | 30    |
|  Первичная работа - не предлагалось  | 7         | 37           | 7            | 150   | 30    |
|  Первичная работа - на осмотре       | 19        | 49           | 19           | 150   | 30    |
|  Отказ - в работе                    |  -        |  -           | 19           | 150   |  -    |
|  Отказ - переподбор                  |  -        |  -           | 19           | 150   |  -    |
|  Распоряжение - в работе             | 30        | 60           | 30           | 150   | 90    |
|  Распоряжение - издано               | 37        | 67           | 37           | 217   | 97    |
|  Суд - разбирательства               |  -        |  -           |  -           | 210   |  -    |
|  Суд - решение                       |  -        |  -           |  -           | 210   |  -    |
|  Договор - проект                    | 45        | 75           | 45           | 225   | 120   |
|  Договор - назначено                 | 60        | 90           | 60           | 240   | 120   |
|  Договор - заключен                  |  -        |  -           |  -           |  -    |  -    |

## Статусы отклонений:
| Тип отклонения   | Правила выбора                                                                                                                                                                |
| ---------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Без отклонений   | - переселение дома ещё не началось (нет фактической даты переселения)<br/>- ожидаемый срок завершения этапа ещё не наступил<br/>- достигнут финальный этап (договор заключен) |
| Требует внимания | - до ожидаемого срока завершения этапа осталось 7 или менее дней                                                                                                              |
| Риск             | - ожидаемый срок завершения этапа наступил                                                                                                                                    |

## Этапы
| id | Группа           | Этап            | Условия                                                       |
|----|------------------|-----------------|---------------------------------------------------------------|
| 1  | Не требуется     | свободно        | Потребность "не требуется" или ФИО "Свободная"                |
| 2  | МФР              | в работе        | Причина выписки "Московский фонд реновации..."                |
| 3  | Первичная работа | не предлагалось | Не подошли иные условия                                       |
| 4  | Первичная работа | на осмотре      | Есть дата осмотра                                             |
| 5  | Отказ            | в работе        | Есть дата отказа                                              |
| 6  | Отказ            | переподбор      | Был отказ и есть более поздняя дата осмотра                   |
| 7  | Распоряжение     | в работе        | Есть дата согласия                                            |
| 8  | Распоряжение     | издано          | Есть дата РД                                                  |
| 9  | Суд              | разбирательства | Есть дата судопроизводства (хотя бы одно) в статусе "Ведётся" |
| 10 | Суд              | решение         | Есть дата судебного решения в завершенном статусе             |
| 11 | Договор          | проект          | У договора есть статус "проект" (за дату взята дата РД)       |
| 12 | Договор          | назначено       | Есть предварительная дата подписания                          |
| 13 | Договор          | заключен        | Есть дата договора                                            |

## Сложность дела
| id | Класс сложности | Условие                                        |
|----|-----------------|------------------------------------------------|
| 1  | Обычное         | Не подошли иные условия                        |
| 2  | Проблемный      | Статус квартиры "аренда" или "федеральная"     |
| 3  | Переподбор      | Есть запись с отказом от квартиры              |
| 4  | Суд             | Есть связанные записи судебной подсистемы      |
| 5  | МФР             | Причина выписки "Московский фонд реновации..." |
